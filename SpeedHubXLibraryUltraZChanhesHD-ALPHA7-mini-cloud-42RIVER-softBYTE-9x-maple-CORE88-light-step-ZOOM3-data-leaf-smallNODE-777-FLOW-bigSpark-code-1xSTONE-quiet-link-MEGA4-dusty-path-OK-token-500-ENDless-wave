local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local HttpService = game:GetService("HttpService")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- // UTILITIES & PROTECTION
local function GetSafeParent()
    local Success, Result = pcall(function()
        return gethui() or (RunService:IsStudio() and Player.PlayerGui) or CoreGui
    end)
    return Success and Result or CoreGui
end

local TobaUI = {}

-- // THEME CONFIGURATION
local Theme = {
    Background = Color3.fromRGB(10, 10, 15),
    Sidebar = Color3.fromRGB(15, 15, 20),
    Element = Color3.fromRGB(20, 20, 25),
    Accent = Color3.fromRGB(0, 255, 180), -- Neon Cyan
    AccentGradient = ColorSequence.new{
        ColorSequenceKeypoint.new(0, Color3.fromRGB(0, 255, 180)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(0, 150, 255))
    },
    Text = Color3.fromRGB(240, 240, 240),
    TextDim = Color3.fromRGB(120, 120, 120),
    Stroke = Color3.fromRGB(40, 40, 50)
}

-- // ANIMATION ENGINE
local function Tween(Obj, Props, Time, Style, Dir)
    TweenService:Create(Obj, TweenInfo.new(Time or 0.3, Style or Enum.EasingStyle.Quart, Dir or Enum.EasingDirection.Out), Props):Play()
end

local function CreateRipple(Parent)
    task.spawn(function()
        local Ripple = Instance.new("ImageLabel")
        Ripple.Name = "Ripple"
        Ripple.Parent = Parent
        Ripple.BackgroundTransparency = 1
        Ripple.Image = "rbxassetid://17028121856" -- Soft glow
        Ripple.ImageColor3 = Theme.Accent
        Ripple.ImageTransparency = 0.6
        Ripple.Position = UDim2.new(0.5, 0, 0.5, 0)
        Ripple.AnchorPoint = Vector2.new(0.5, 0.5)
        Ripple.Size = UDim2.new(0, 0, 0, 0)
        
        Tween(Ripple, {Size = UDim2.new(1.5, 0, 1.5, 0), ImageTransparency = 1}, 0.6)
        task.wait(0.6)
        Ripple:Destroy()
    end)
end

-- // DRAGGING LOGIC (MOBILE FRIENDLY)
local function MakeDraggable(Frame, Handle)
    local Dragging, DragInput, DragStart, StartPos
    
    Handle.InputBegan:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
            Dragging = true
            DragStart = Input.Position
            StartPos = Frame.Position
            
            Input.Changed:Connect(function()
                if Input.UserInputState == Enum.UserInputState.End then
                    Dragging = false
                end
            end)
        end
    end)
    
    Handle.InputChanged:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseMovement or Input.UserInputType == Enum.UserInputType.Touch then
            DragInput = Input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(Input)
        if Input == DragInput and Dragging then
            local Delta = Input.Position - DragStart
            Tween(Frame, {Position = UDim2.new(StartPos.X.Scale, StartPos.X.Offset + Delta.X, StartPos.Y.Scale, StartPos.Y.Offset + Delta.Y)}, 0.05)
        end
    end)
end

-- // MAIN LIBRARY
function TobaUI:Window(Config)
    local TitleText = Config.Title or "TobaUI"
    local SubTitleText = Config.SubTitle or "Ultimate"
    local Size = Config.Size or UDim2.fromOffset(580, 400)

    -- ScreenGui
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "TobaUI_" .. HttpService:GenerateGUID(false)
    ScreenGui.Parent = GetSafeParent()
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.IgnoreGuiInset = true

    -- Mobile Toggle Button
    local MobileToggle = Instance.new("TextButton")
    MobileToggle.Name = "MobileToggle"
    MobileToggle.Parent = ScreenGui
    MobileToggle.Position = UDim2.new(0.1, 0, 0.1, 0)
    MobileToggle.Size = UDim2.new(0, 45, 0, 45)
    MobileToggle.BackgroundColor3 = Theme.Background
    MobileToggle.Text = ""
    MobileToggle.AutoButtonColor = false
    
    local MTStroke = Instance.new("UIStroke")
    MTStroke.Parent = MobileToggle
    MTStroke.Color = Theme.Accent
    MTStroke.Thickness = 2
    
    local MTCorner = Instance.new("UICorner")
    MTCorner.CornerRadius = UDim.new(0.5, 0)
    MTCorner.Parent = MobileToggle
    
    local MTIcon = Instance.new("ImageLabel")
    MTIcon.Parent = MobileToggle
    MTIcon.Size = UDim2.new(0, 24, 0, 24)
    MTIcon.Position = UDim2.new(0.5, 0, 0.5, 0)
    MTIcon.AnchorPoint = Vector2.new(0.5, 0.5)
    MTIcon.BackgroundTransparency = 1
    MTIcon.Image = "rbxassetid://18270920788" -- Toba Logo/Icon
    MTIcon.ImageColor3 = Theme.Accent

    MakeDraggable(MobileToggle, MobileToggle)

    -- Main Container
    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Parent = ScreenGui
    Main.Size = UDim2.new(0, 0, 0, 0) -- Animation start
    Main.Position = UDim2.new(0.5, 0, 0.5, 0)
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Theme.Background
    Main.ClipsDescendants = true
    
    local MainCorner = Instance.new("UICorner")
    MainCorner.CornerRadius = UDim.new(0, 12)
    MainCorner.Parent = Main
    
    local MainStroke = Instance.new("UIStroke")
    MainStroke.Parent = Main
    MainStroke.Thickness = 2
    MainStroke.Color = Color3.new(1,1,1)
    
    local StrokeGrad = Instance.new("UIGradient")
    StrokeGrad.Parent = MainStroke
    StrokeGrad.Color = Theme.AccentGradient
    StrokeGrad.Rotation = 45

    -- Background Glow
    local BgGlow = Instance.new("ImageLabel")
    BgGlow.Parent = Main
    BgGlow.Size = UDim2.new(1.5, 0, 1.5, 0)
    BgGlow.Position = UDim2.new(0.5, 0, 0.5, 0)
    BgGlow.AnchorPoint = Vector2.new(0.5, 0.5)
    BgGlow.Image = "rbxassetid://17028121856"
    BgGlow.ImageColor3 = Theme.Accent
    BgGlow.ImageTransparency = 0.92
    BgGlow.BackgroundTransparency = 1
    BgGlow.ZIndex = 0

    -- Animation: Open
    Tween(Main, {Size = Size}, 0.7, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out)

    -- Sidebar
    local Sidebar = Instance.new("Frame")
    Sidebar.Name = "Sidebar"
    Sidebar.Parent = Main
    Sidebar.Size = UDim2.new(0, 150, 1, 0)
    Sidebar.BackgroundColor3 = Theme.Sidebar
    Sidebar.BorderSizePixel = 0
    
    local SideCorner = Instance.new("UICorner")
    SideCorner.CornerRadius = UDim.new(0, 12)
    SideCorner.Parent = Sidebar
    
    local SideCover = Instance.new("Frame") -- Covers right rounded corners of sidebar
    SideCover.Parent = Sidebar
    SideCover.Size = UDim2.new(0, 10, 1, 0)
    SideCover.Position = UDim2.new(1, -10, 0, 0)
    SideCover.BackgroundColor3 = Theme.Sidebar
    SideCover.BorderSizePixel = 0

    -- Title Area
    local TitleLbl = Instance.new("TextLabel")
    TitleLbl.Parent = Sidebar
    TitleLbl.Size = UDim2.new(1, -20, 0, 40)
    TitleLbl.Position = UDim2.new(0, 15, 0, 10)
    TitleLbl.BackgroundTransparency = 1
    TitleLbl.Text = TitleText
    TitleLbl.Font = Enum.Font.GothamBlack
    TitleLbl.TextSize = 18
    TitleLbl.TextColor3 = Theme.Text
    TitleLbl.TextXAlignment = Enum.TextXAlignment.Left
    
    local SubTitleLbl = Instance.new("TextLabel")
    SubTitleLbl.Parent = Sidebar
    SubTitleLbl.Size = UDim2.new(1, -20, 0, 20)
    SubTitleLbl.Position = UDim2.new(0, 15, 0, 32)
    SubTitleLbl.BackgroundTransparency = 1
    SubTitleLbl.Text = SubTitleText
    SubTitleLbl.Font = Enum.Font.Gotham
    SubTitleLbl.TextSize = 12
    SubTitleLbl.TextColor3 = Theme.Accent
    SubTitleLbl.TextXAlignment = Enum.TextXAlignment.Left

    -- Tab Container
    local TabScroll = Instance.new("ScrollingFrame")
    TabScroll.Parent = Sidebar
    TabScroll.Size = UDim2.new(1, 0, 1, -70)
    TabScroll.Position = UDim2.new(0, 0, 0, 70)
    TabScroll.BackgroundTransparency = 1
    TabScroll.ScrollBarThickness = 0
    
    local TabLayout = Instance.new("UIListLayout")
    TabLayout.Parent = TabScroll
    TabLayout.Padding = UDim.new(0, 8)
    TabLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

    -- Page Container
    local PageContainer = Instance.new("Frame")
    PageContainer.Name = "Pages"
    PageContainer.Parent = Main
    PageContainer.Size = UDim2.new(1, -160, 1, -20)
    PageContainer.Position = UDim2.new(0, 155, 0, 10)
    PageContainer.BackgroundTransparency = 1
    
    -- Drag Logic
    MakeDraggable(Main, Sidebar)

    -- Toggle Logic
    local IsOpen = true
    MobileToggle.MouseButton1Click:Connect(function()
        IsOpen = not IsOpen
        if IsOpen then
            Main.Visible = true
            Tween(Main, {Size = Size, BackgroundTransparency = 0}, 0.5, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out)
            Tween(MainStroke, {Transparency = 0}, 0.5)
            for _, v in pairs(Main:GetDescendants()) do
                if v:IsA("TextLabel") or v:IsA("ImageLabel") then
                     Tween(v, {TextTransparency = 0, ImageTransparency = 0}, 0.3)
                end
            end
        else
            Tween(Main, {Size = UDim2.new(0,0,0,0), BackgroundTransparency = 1}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.In)
            Tween(MainStroke, {Transparency = 1}, 0.3)
            task.wait(0.3)
            Main.Visible = false
        end
    end)

    local Handler = {}
    
    function Handler:Tab(Name, IconId)
        local TabBtn = Instance.new("TextButton")
        TabBtn.Parent = TabScroll
        TabBtn.Size = UDim2.new(0, 130, 0, 35)
        TabBtn.BackgroundColor3 = Theme.Background
        TabBtn.BackgroundTransparency = 1
        TabBtn.Text = ""
        TabBtn.AutoButtonColor = false
        
        local TabCorner = Instance.new("UICorner")
        TabCorner.CornerRadius = UDim.new(0, 8)
        TabCorner.Parent = TabBtn
        
        local TabLabel = Instance.new("TextLabel")
        TabLabel.Parent = TabBtn
        TabLabel.Size = UDim2.new(1, -30, 1, 0)
        TabLabel.Position = UDim2.new(0, 10, 0, 0)
        TabLabel.BackgroundTransparency = 1
        TabLabel.Text = Name
        TabLabel.TextColor3 = Theme.TextDim
        TabLabel.Font = Enum.Font.GothamMedium
        TabLabel.TextSize = 13
        TabLabel.TextXAlignment = Enum.TextXAlignment.Left
        
        -- Selection Indicator
        local Indicator = Instance.new("Frame")
        Indicator.Parent = TabBtn
        Indicator.Size = UDim2.new(0, 3, 0, 15)
        Indicator.Position = UDim2.new(0, 0, 0.5, 0)
        Indicator.AnchorPoint = Vector2.new(0, 0.5)
        Indicator.BackgroundColor3 = Theme.Accent
        Indicator.BackgroundTransparency = 1
        
        local IndCorner = Instance.new("UICorner")
        IndCorner.CornerRadius = UDim.new(1, 0)
        IndCorner.Parent = Indicator

        -- Page
        local Page = Instance.new("ScrollingFrame")
        Page.Name = Name .. "Page"
        Page.Parent = PageContainer
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.BackgroundTransparency = 1
        Page.ScrollBarThickness = 2
        Page.ScrollBarImageColor3 = Theme.Accent
        Page.Visible = false
        
        local PageLayout = Instance.new("UIListLayout")
        PageLayout.Parent = Page
        PageLayout.Padding = UDim.new(0, 6)
        PageLayout.SortOrder = Enum.SortOrder.LayoutOrder
        
        PageLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Page.CanvasSize = UDim2.new(0, 0, 0, PageLayout.AbsoluteContentSize.Y + 20)
        end)
        
        local PagePad = Instance.new("UIPadding")
        PagePad.Parent = Page
        PagePad.PaddingTop = UDim.new(0, 5)
        PagePad.PaddingLeft = UDim.new(0, 2)

        -- Tab Activation Logic
        local function Activate()
            for _, v in pairs(PageContainer:GetChildren()) do
                v.Visible = false
            end
            Page.Visible = true
            
            -- Reset others
            for _, btn in pairs(TabScroll:GetChildren()) do
                if btn:IsA("TextButton") then
                    Tween(btn.TextLabel, {TextColor3 = Theme.TextDim}, 0.3)
                    Tween(btn.Frame, {BackgroundTransparency = 1, Size = UDim2.new(0,3,0,15)}, 0.3)
                    Tween(btn, {BackgroundTransparency = 1}, 0.3)
                end
            end
            
            -- Active style
            Tween(TabLabel, {TextColor3 = Theme.Text}, 0.3)
            Tween(Indicator, {BackgroundTransparency = 0, Size = UDim2.new(0, 3, 0, 20)}, 0.3, Enum.EasingStyle.Elastic)
            Tween(TabBtn, {BackgroundTransparency = 0.95}, 0.3)
        end

        TabBtn.MouseButton1Click:Connect(Activate)
        
        -- Auto select first tab
        if #TabScroll:GetChildren() == 2 then -- UIListLayout + this button
            Activate()
        end

        local Elements = {}

        function Elements:Button(Title, Callback)
            Callback = Callback or function() end
            
            local Btn = Instance.new("Frame")
            Btn.Parent = Page
            Btn.Size = UDim2.new(1, -10, 0, 38)
            Btn.BackgroundColor3 = Theme.Element
            
            local BtnCorner = Instance.new("UICorner")
            BtnCorner.CornerRadius = UDim.new(0, 6)
            BtnCorner.Parent = Btn
            
            local BtnStroke = Instance.new("UIStroke")
            BtnStroke.Parent = Btn
            BtnStroke.Color = Theme.Stroke
            BtnStroke.Thickness = 1
            
            local BtnLabel = Instance.new("TextLabel")
            BtnLabel.Parent = Btn
            BtnLabel.Size = UDim2.new(1, -10, 1, 0)
            BtnLabel.Position = UDim2.new(0, 10, 0, 0)
            BtnLabel.BackgroundTransparency = 1
            BtnLabel.Text = Title
            BtnLabel.TextColor3 = Theme.Text
            BtnLabel.Font = Enum.Font.GothamSemibold
            BtnLabel.TextSize = 13
            BtnLabel.TextXAlignment = Enum.TextXAlignment.Left
            
            local Icon = Instance.new("ImageLabel")
            Icon.Parent = Btn
            Icon.Size = UDim2.new(0, 18, 0, 18)
            Icon.Position = UDim2.new(1, -10, 0.5, 0)
            Icon.AnchorPoint = Vector2.new(1, 0.5)
            Icon.Image = "rbxassetid://106471194043211" -- Pointer
            Icon.BackgroundTransparency = 1
            Icon.ImageColor3 = Theme.TextDim
            
            local Interact = Instance.new("TextButton")
            Interact.Parent = Btn
            Interact.Size = UDim2.new(1, 0, 1, 0)
            Interact.BackgroundTransparency = 1
            Interact.Text = ""
            
            Interact.MouseEnter:Connect(function()
                Tween(BtnStroke, {Color = Theme.Accent}, 0.3)
                Tween(Icon, {Position = UDim2.new(1, -6, 0.5, 0), ImageColor3 = Theme.Accent}, 0.3)
            end)
            
            Interact.MouseLeave:Connect(function()
                Tween(BtnStroke, {Color = Theme.Stroke}, 0.3)
                Tween(Icon, {Position = UDim2.new(1, -10, 0.5, 0), ImageColor3 = Theme.TextDim}, 0.3)
            end)
            
            Interact.MouseButton1Click:Connect(function()
                CreateRipple(Btn)
                Callback()
            end)
        end

        function Elements:Toggle(Title, Default, Callback)
            Callback = Callback or function() end
            local State = Default or false
            
            local Tog = Instance.new("Frame")
            Tog.Parent = Page
            Tog.Size = UDim2.new(1, -10, 0, 38)
            Tog.BackgroundColor3 = Theme.Element
            
            local TogCorner = Instance.new("UICorner")
            TogCorner.CornerRadius = UDim.new(0, 6)
            TogCorner.Parent = Tog
            
            local TogStroke = Instance.new("UIStroke")
            TogStroke.Parent = Tog
            TogStroke.Color = Theme.Stroke
            TogStroke.Thickness = 1
            
            local TogLabel = Instance.new("TextLabel")
            TogLabel.Parent = Tog
            TogLabel.Size = UDim2.new(1, -60, 1, 0)
            TogLabel.Position = UDim2.new(0, 10, 0, 0)
            TogLabel.BackgroundTransparency = 1
            TogLabel.Text = Title
            TogLabel.TextColor3 = Theme.Text
            TogLabel.Font = Enum.Font.GothamSemibold
            TogLabel.TextSize = 13
            TogLabel.TextXAlignment = Enum.TextXAlignment.Left
            
            -- Switch UI
            local SwitchBg = Instance.new("Frame")
            SwitchBg.Parent = Tog
            SwitchBg.Size = UDim2.new(0, 42, 0, 22)
            SwitchBg.Position = UDim2.new(1, -10, 0.5, 0)
            SwitchBg.AnchorPoint = Vector2.new(1, 0.5)
            SwitchBg.BackgroundColor3 = State and Theme.Accent or Color3.fromRGB(35, 35, 40)
            
            local SwitchCorner = Instance.new("UICorner")
            SwitchCorner.CornerRadius = UDim.new(1, 0)
            SwitchCorner.Parent = SwitchBg
            
            local SwitchDot = Instance.new("Frame")
            SwitchDot.Parent = SwitchBg
            SwitchDot.Size = UDim2.new(0, 18, 0, 18)
            SwitchDot.Position = State and UDim2.new(1, -20, 0.5, 0) or UDim2.new(0, 2, 0.5, 0)
            SwitchDot.AnchorPoint = Vector2.new(0, 0.5)
            SwitchDot.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            
            local DotCorner = Instance.new("UICorner")
            DotCorner.CornerRadius = UDim.new(1, 0)
            DotCorner.Parent = SwitchDot
            
            local Interact = Instance.new("TextButton")
            Interact.Parent = Tog
            Interact.Size = UDim2.new(1, 0, 1, 0)
            Interact.BackgroundTransparency = 1
            Interact.Text = ""
            
            local function Update()
                if State then
                    Tween(SwitchBg, {BackgroundColor3 = Theme.Accent}, 0.2)
                    Tween(SwitchDot, {Position = UDim2.new(1, -20, 0.5, 0)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
                    Tween(TogStroke, {Color = Theme.Accent}, 0.2)
                else
                    Tween(SwitchBg, {BackgroundColor3 = Color3.fromRGB(35, 35, 40)}, 0.2)
                    Tween(SwitchDot, {Position = UDim2.new(0, 2, 0.5, 0)}, 0.3, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
                    Tween(TogStroke, {Color = Theme.Stroke}, 0.2)
                end
                Callback(State)
            end
            
            Interact.MouseButton1Click:Connect(function()
                State = not State
                Update()
            end)
            
            if State then Update() end
        end

        function Elements:Slider(Title, Min, Max, Default, Callback)
            local Value = Default or Min
            Callback = Callback or function() end
            
            local Slide = Instance.new("Frame")
            Slide.Parent = Page
            Slide.Size = UDim2.new(1, -10, 0, 55)
            Slide.BackgroundColor3 = Theme.Element
            
            local SCorner = Instance.new("UICorner")
            SCorner.CornerRadius = UDim.new(0, 6)
            SCorner.Parent = Slide
            
            local SStroke = Instance.new("UIStroke")
            SStroke.Parent = Slide
            SStroke.Color = Theme.Stroke
            SStroke.Thickness = 1
            
            local SLabel = Instance.new("TextLabel")
            SLabel.Parent = Slide
            SLabel.Size = UDim2.new(1, -10, 0, 20)
            SLabel.Position = UDim2.new(0, 10, 0, 5)
            SLabel.BackgroundTransparency = 1
            SLabel.Text = Title
            SLabel.TextColor3 = Theme.Text
            SLabel.Font = Enum.Font.GothamSemibold
            SLabel.TextSize = 13
            SLabel.TextXAlignment = Enum.TextXAlignment.Left
            
            local SValue = Instance.new("TextLabel")
            SValue.Parent = Slide
            SValue.Size = UDim2.new(0, 50, 0, 20)
            SValue.Position = UDim2.new(1, -10, 0, 5)
            SValue.AnchorPoint = Vector2.new(1, 0)
            SValue.BackgroundTransparency = 1
            SValue.Text = tostring(Value)
            SValue.TextColor3 = Theme.Accent
            SValue.Font = Enum.Font.GothamBold
            SValue.TextSize = 13
            SValue.TextXAlignment = Enum.TextXAlignment.Right
            
            -- Bar
            local BarBg = Instance.new("Frame")
            BarBg.Parent = Slide
            BarBg.Size = UDim2.new(1, -20, 0, 6)
            BarBg.Position = UDim2.new(0, 10, 0, 35)
            BarBg.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
            
            local BarCorner = Instance.new("UICorner")
            BarCorner.CornerRadius = UDim.new(1, 0)
            BarCorner.Parent = BarBg
            
            local BarFill = Instance.new("Frame")
            BarFill.Parent = BarBg
            BarFill.Size = UDim2.new((Value - Min)/(Max - Min), 0, 1, 0)
            BarFill.BackgroundColor3 = Theme.Accent
            
            local FillCorner = Instance.new("UICorner")
            FillCorner.CornerRadius = UDim.new(1, 0)
            FillCorner.Parent = BarFill
            
            local Knob = Instance.new("Frame")
            Knob.Parent = BarFill
            Knob.Size = UDim2.new(0, 14, 0, 14)
            Knob.Position = UDim2.new(1, 0, 0.5, 0)
            Knob.AnchorPoint = Vector2.new(0.5, 0.5)
            Knob.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
            
            local KnobCorner = Instance.new("UICorner")
            KnobCorner.CornerRadius = UDim.new(1, 0)
            KnobCorner.Parent = Knob
            
            local Interact = Instance.new("TextButton")
            Interact.Parent = Slide
            Interact.Size = UDim2.new(1, 0, 1, 0)
            Interact.BackgroundTransparency = 1
            Interact.Text = ""
            
            local Dragging = false
            
            local function Update(Input)
                local SizeScale = math.clamp((Input.Position.X - BarBg.AbsolutePosition.X) / BarBg.AbsoluteSize.X, 0, 1)
                local NewValue = math.floor(Min + ((Max - Min) * SizeScale))
                Value = NewValue
                SValue.Text = tostring(Value)
                Tween(BarFill, {Size = UDim2.new(SizeScale, 0, 1, 0)}, 0.05)
                Callback(Value)
            end
            
            Interact.InputBegan:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = true
                    Update(Input)
                    Tween(Knob, {Size = UDim2.new(0, 18, 0, 18)}, 0.1)
                end
            end)
            
            Interact.InputEnded:Connect(function(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 or Input.UserInputType == Enum.UserInputType.Touch then
                    Dragging = false
                    Tween(Knob, {Size = UDim2.new(0, 14, 0, 14)}, 0.1)
                end
            end)
            
            UserInputService.InputChanged:Connect(function(Input)
                if Dragging and (Input.UserInputType == Enum.UserInputType.MouseMovement or Input.UserInputType == Enum.UserInputType.Touch) then
                    Update(Input)
                end
            end)
        end

        return Elements
    end

    return Handler
end

function TobaUI:Notify(Title, Content)
    local ScreenGui = GetSafeParent():FindFirstChild("TobaUI_Notifs")
    if not ScreenGui then
        ScreenGui = Instance.new("ScreenGui")
        ScreenGui.Name = "TobaUI_Notifs"
        ScreenGui.Parent = GetSafeParent()
    end
    
    local Container = ScreenGui:FindFirstChild("Container")
    if not Container then
        Container = Instance.new("Frame")
        Container.Name = "Container"
        Container.Parent = ScreenGui
        Container.Position = UDim2.new(1, -320, 1, -20)
        Container.AnchorPoint = Vector2.new(0, 1)
        Container.Size = UDim2.new(0, 300, 1, 0)
        Container.BackgroundTransparency = 1
        
        local Layout = Instance.new("UIListLayout")
        Layout.Parent = Container
        Layout.VerticalAlignment = Enum.VerticalAlignment.Bottom
        Layout.Padding = UDim.new(0, 10)
    end
    
    local Notif = Instance.new("Frame")
    Notif.Parent = Container
    Notif.Size = UDim2.new(1, 0, 0, 0) -- Grow animation
    Notif.BackgroundColor3 = Theme.Element
    Notif.ClipsDescendants = true
    
    local NCorner = Instance.new("UICorner")
    NCorner.CornerRadius = UDim.new(0, 8)
    NCorner.Parent = Notif
    
    local NStroke = Instance.new("UIStroke")
    NStroke.Parent = Notif
    NStroke.Color = Theme.Accent
    NStroke.Thickness = 1
    
    local NTitle = Instance.new("TextLabel")
    NTitle.Parent = Notif
    NTitle.Position = UDim2.new(0, 10, 0, 5)
    NTitle.Size = UDim2.new(1, -20, 0, 20)
    NTitle.BackgroundTransparency = 1
    NTitle.Text = Title
    NTitle.Font = Enum.Font.GothamBold
    NTitle.TextColor3 = Theme.Accent
    NTitle.TextSize = 14
    NTitle.TextXAlignment = Enum.TextXAlignment.Left
    
    local NContent = Instance.new("TextLabel")
    NContent.Parent = Notif
    NContent.Position = UDim2.new(0, 10, 0, 25)
    NContent.Size = UDim2.new(1, -20, 0, 40)
    NContent.BackgroundTransparency = 1
    NContent.Text = Content
    NContent.Font = Enum.Font.Gotham
    NContent.TextColor3 = Theme.Text
    NContent.TextSize = 12
    NContent.TextXAlignment = Enum.TextXAlignment.Left
    NContent.TextWrapped = true
    
    Tween(Notif, {Size = UDim2.new(1, 0, 0, 70)}, 0.4, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out)
    
    task.delay(4, function()
        Tween(Notif, {Size = UDim2.new(1, 0, 0, 0), BackgroundTransparency = 1}, 0.3)
        Tween(NTitle, {TextTransparency = 1}, 0.2)
        Tween(NContent, {TextTransparency = 1}, 0.2)
        Tween(NStroke, {Transparency = 1}, 0.2)
        task.wait(0.3)
        Notif:Destroy()
    end)
end

return TobaUI
